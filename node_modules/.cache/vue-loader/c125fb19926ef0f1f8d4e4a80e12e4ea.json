{"remainingRequest":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\src\\pages\\Maps.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\src\\pages\\Maps.vue","mtime":1715189523988},{"path":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713478866974},{"path":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\node_modules\\babel-loader\\lib\\index.js","mtime":1713478866263},{"path":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1713478866974},{"path":"C:\\Users\\PC\\Desktop\\Otros\\DP1\\Front\\dp1_front-Redex\\Redex\\node_modules\\vue-loader\\lib\\index.js","mtime":1713478868660}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Mapbox from \"mapbox-gl\";\nimport {MglMap, MglNavigationControl, MglGeojsonLayer} from \"vue-mapbox\";\nimport Mapa from '@/store/map.json';\nimport Mapa2 from '@/store/map2.json';\nimport axios from 'axios';\nimport Authentication from '@/store/authentication.js';\nimport Simulation from '@/store/simulation.js';\n\nexport default {\n  components: {\n    MglMap,\n    MglNavigationControl,\n    MglGeojsonLayer\n  },\n  data() {\n    return {\n      isLegendOpen: false,\n      currentDateTime: new Date().toLocaleString('es-ES', { \n        timeZone: 'America/Lima', \n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit', \n        minute: '2-digit', \n        timeZoneName: 'short' \n      }),\n      toggleIniciarDetener: true,\n      toggleReanudar: false,\n      accessToken: this.$store.state.map.token, // your access token. Needed if you using Mapbox maps\n      mapStyle: 'mapbox://styles/mapbox/dark-v10',\n      center: [5,15],\n      zoom: 2,\n      sedes:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"sedes\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      sedesCount:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"sedesCount\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa.features\n        },\n        \n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      rutas:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"rutas\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa2.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      rutasCount:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"rutasCount\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa2.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      sedesLayer:{\n        id: 'sedesLayer',\n        type: 'circle',\n        source: 'sedes',\n        filter: ['has', 'capacidad'],\n        paint: {\n            'circle-color':'#3b9e6e',\n            'circle-radius':26\n\n        }\n      },\n      sedesLayerCount:{\n        id:'sedesLayerCount',\n        type: 'symbol',\n        source: 'sedesCount',\n        filter: ['has', 'capacidad'],\n        layout: {\n            'text-field': '{capacidad}',\n            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n            'text-size': 12\n        }\n      },\n      rutasLayer:{\n        id: 'rutasLayer',\n        type: 'circle',\n        source: 'rutas',\n        filter: ['has', 'capacidad'],\n        paint: {\n            'circle-color':'#8965e0',\n            'circle-radius':15\n\n        }\n      },\n      rutasLayerCount:{\n        id:'rutasLayerCount',\n        type: 'symbol',\n        source: 'rutasCount',\n        filter: ['has', 'capacidad'],\n        layout: {\n            'text-field': '{capacidad}',\n            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n            'text-size': 12\n        }\n      },\n\n      myInterval: null,\n      myIntervalReplan:null,\n\n      fecha_inicio_simulacion: null,\n      fecha_fin_simulacion: null,\n\n      type: [\"\", \"info\", \"success\", \"warning\", \"danger\"],\n      notifications: {\n        topCenter: false\n      }\n      \n    }\n  },\n  mounted(){\n    \n    let vue = this;\n    this.updateTime();\n  },\n  destroyed:{\n  },\n  methods: {\n\n\n    toggleLegend() {\n      this.isLegendOpen = !this.isLegendOpen;\n    },\n\n    updateTime() {\n\n      setInterval(() => {\n        this.currentDateTime = new Date().toLocaleString('es-ES', { \n          timeZone: 'America/Lima', \n          year: 'numeric',\n          month: '2-digit',\n          day: '2-digit',\n          hour: '2-digit', \n          minute: '2-digit', \n          timeZoneName: 'short'\n        });\n      }, 1000); },\n    onMapLoaded(event) {\n      // in component\n      this.map = event.map;\n      // or just to store if you want have access from other components\n      this.$store.map = event.map;\n    },\n    iniciarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = false;\n\n/*\n      vue.myInterval = setInterval(()  =>{\n        axios.get(vue.$store.state.appUri + '/sedes/listarSedes')\n        .then(function(response){\n          console.log(response.data)\n          response.data.forEach(element => {  \n            Mapa.features.push(\n              { \"type\": \"Feature\",\n                \"properties\": { \"id\": element.codigoOaci,  \"capacidad\": element.codigoOaci + \":  \" + element.numero_paquetes.toString() },\n                \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.coordenadas[1],element.coordenadas[0],0.0]}\n              }\n            );       \n          });\n        })\n        .catch(function(error){\n          console.log(error);\n        });\n      }, 10000);\n*/\n\n      /*MOSTRAR RUTAS*/\n      \n      axios.post(vue.$store.state.appUri + '/simulacion/simular/'+ vue.fecha_inicio_simulacion.substring(8,10)+\n                                                              '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                              '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                              '/'+Authentication.getProfile().id)\n      .then(function(response){\n        Simulation.runSimulation(response.data.simulacion.id);\n        console.log(Simulation.getIdSimulation());\n\n        /*\n        axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion2/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                                          '/'+Simulation.getIdSimulation());  \n        */\n\n        var date = new Date();\n        var day = date.getDate();\n        var month = date.getMonth() + 1;\n        var year = date.getFullYear();\n        var hour = date.getUTCHours();\n        var min = date.getUTCMinutes();\n\n        if(hour + 4 >= 24){\n          hour= hour + 4 - 24;\n        }\n\n        axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                          '/'+hour.toString()+'/'+min.toString()+'/'+Simulation.getIdSimulation());\n\n\n\n        /*TIMER REPLANIFICACION*/\n        vue.myIntervalReplan = setInterval(()  =>{\n\n          var date = new Date();\n          var day = date.getDate();\n          var month = date.getMonth() + 1;\n          var year = date.getFullYear();\n          var hour = date.getUTCHours();\n          var min = date.getUTCMinutes();\n          var diaSim;\n\n          if(hour + 4 >= 24){\n            hour= hour + 4 - 24;\n            diaSim = Number(vuefecha_inicio_simulacion) + 1;\n          }else{\n            hour= hour + 4;\n          }\n\n          axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion/'  +diaSim.toString()+//  vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                            '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                            '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                            '/'+hour.toString()+'/'+min.toString()+'/'+Simulation.getIdSimulation())\n          .then(function(response){\n            axios.post(vue.$store.state.appUri + '/paquetes/actualizarEstadoPaquetes/' +day.toString()+\n                                                                                    '/'+month.toString()+\n                                                                                    '/'+year.toString()+\n                                                                                    '/'+hour.toString()+\n                                                                                    '/'+min.toString())\n          });\n        }, 600000);\n\n\n        /*TIMER MAPA*/\n        vue.myInterval = setInterval(()  =>{          \n\n\n          axios.get(vue.$store.state.appUri + '/simulacion/mapa/'+Simulation.getIdSimulation())\n          .then(function(response2){\n\n            if(response2.data.c != null){              \n              console.log(\"SE DETIENE LA SIMULACION\");\n              console.log(response2.data);\n              Simulation.stopSimulation();\n              clearInterval(vue.myInterval);\n              this.notifyVue('top', 'center',4,NotificationTemplatePaqueteError);\n            }else{\n              console.log(response2.data);\n              //Mapa.features = [];\n              //Mapa2.features = [];\n              \n              response2.data.sedes.forEach(element => {               \n                \n              Mapa.features.push(\n                  { \"type\": \"Feature\",\n                    \"properties\": { \"id\": element.codigoOaci,  \"capacidad\": element.codigoOaci + \":  \" + Math.abs(element.numero_paquetes).toString() },\n                    \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.latitud,element.longitud,0.0]}\n                  }\n                );       \n              });\n\n\n              response2.data.rutasDto.forEach(element => {  \n              Mapa2.features.push(\n                  { \"type\": \"Feature\",\n                    \"properties\": { \"id\": element.id,  \"capacidad\": element.numero_paquetes_ruta.toString() },\n                    \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.coordenadas[1],element.coordenadas[0],0.0]}\n                  }\n                );       \n              });\n            }\n\n\n          });\n        }, 300000);\n\n      });\n\n\n    },\n    detenerSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = true;\n      \n    },\n    reanudarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = false;\n    },\n    cancelarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = true;\n      console.log(\"SE DETIENE LA SIMULACION\");\n      clearInterval(vue.myInterval);\n      Simulation.stopSimulation();\n      console.log(vue.fecha_fin_simulacion);\n    },\n    async simu(){\n      let vue = this;\n      let response = axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion2/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                                        '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                                        '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                                                        '/'+Simulation.getIdSimulation());\n        console.log(response.data);  \n    },\n    notifyVue(verticalAlign, horizontalAlign,color,componente) {\n      //const color = 4;\n      //console.log(color);\n      this.$notify({\n        component: componente,\n        icon: \"tim-icons icon-bell-55\",\n        horizontalAlign: horizontalAlign,\n        verticalAlign: verticalAlign,\n        type: this.type[color],\n        timeout: 0\n      });\n    }\n\n\n    /*\n    calcularTriangulacion(x1,x2,y1,y2,porcentaje){\n\n      var distanciaX = Math.abs(x1-x2)*porcentaje;\n      var distanciaY = Math.abs(y1-y2)*porcentaje;\n\n      var nuevaCoordenada = [];\n\n      if(x1>x2){\n        nuevaCoordenada.push(x1-distanciaX);\n      }else{\n        nuevaCoordenada.push(x1+distanciaX);\n      }\n\n      if(y1>y2){\n        nuevaCoordenada.push(y1-distanciaY);\n      }else{\n        nuevaCoordenada.push(y1+distanciaY);\n      }\n\n      return nuevaCoordenada.push(0.00);\n    } background-color: #1e1e24;\n    */\n  }\n}\n",{"version":3,"sources":["Maps.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+HA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;AAIA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"Maps.vue","sourceRoot":"src/pages","sourcesContent":["<template>\n  \n   <div class=\"map-container\">\n    \n    <div class=\"datetime-display\">\n      {{ currentDateTime }}\n    </div>\n    <div class=\"map-search-container\">\n      \n      <input class=\"search-input\" type=\"text\" placeholder=\"Buscar envío\">\n      <input class=\"search-input\" type=\"text\" placeholder=\"Buscar aeropuerto\">\n      <input class=\"search-input\" type=\"text\" placeholder=\"Buscar vuelo\">\n    </div>\n    <div id=\"legend\" class=\"map-legend\">\n  <button class=\"legend-toggle\" @click=\"toggleLegend\">\n    {{ isLegendOpen ? '▲ Cerrar Leyenda' : '▼ Abrir Leyenda' }}\n  </button>\n  <ul :style=\"{ display: isLegendOpen ? 'block' : 'none' }\" class=\"legend-content\">\n\n    <li><span class=\"dot less-50\"></span>Menor a 50%</li>\n    <li><span class=\"dot between-50-80\"></span>Entre 50% y 80%</li>\n    <li><span class=\"dot greater-80\"></span>Mayor a 80%</li>\n    <li><span class=\"icon airplane-icon\"></span>Vuelo</li>\n    <li><span class=\"icon airport-icon\"></span>Aeropuerto</li>\n  </ul>\n</div>\n\n    \n    <MglMap class=\"main-map\" :accessToken=\"accessToken\" \n            :mapStyle=\"mapStyle\" :center=\"center\" \n            :zoom=\"zoom\" style=\"height:750px!important;\" \n            :renderWorldCopies = false\n            @onload=\"onMapLoaded\">\n\n      <MglNavigationControl\n        position=\"top-center\">\n      </MglNavigationControl> \n\n      <MglGeojsonLayer\n        :sourceId=\"sedes.data.id\"\n        :source=\"sedes\"\n        :layerId=\"sedesLayer.id\"\n        :layer=\"sedesLayer\">\n      </MglGeojsonLayer>\n\n      <MglGeojsonLayer\n        :sourceId=\"sedesCount.data.id\"\n        :source=\"sedesCount\"\n        :layerId=\"sedesLayerCount.id\"\n        :layer=\"sedesLayerCount\">\n      </MglGeojsonLayer>\n\n      <MglGeojsonLayer\n        :sourceId=\"rutas.data.id\"\n        :source=\"rutas\"\n        :layerId=\"rutasLayer.id\"\n        :layer=\"rutasLayer\">\n      </MglGeojsonLayer>\n\n      <MglGeojsonLayer\n        :sourceId=\"rutasCount.data.id\"\n        :source=\"rutasCount\"\n        :layerId=\"rutasLayerCount.id\"\n        :layer=\"rutasLayerCount\">\n      </MglGeojsonLayer>\n      \n    </MglMap>\n\n\n    <!-- <div id=\"map\" style=\"height:750px!important;\"></div> -->\n\n    \n    <div class=\"row\" style=\"margin-top:40px!important\"> \n      <div class=\"col-md-3 pr-md-1\">\n        <base-input label=\"Fecha Inicio\"\n                  type=\"date\"\n                  format= \"yyyy-MM-dd\"\n                  placeholder=\"Fecha Inicio\"\n                  v-model=\"fecha_inicio_simulacion\">\n        </base-input>\n      </div>\n      <div class=\"col-md-3 pr-md-1\">\n        <base-input label=\"Fecha Fin\"\n                  type=\"date\"\n                  format= \"yyyy-MM-dd\"\n                  placeholder=\"Fecha Fin\"\n                  v-model=\"fecha_fin_simulacion\">\n        </base-input>\n      </div>\n    </div>\n\n\n    <div class=\"row\">\n      <div class=\"col-md-3\" style=\"margin-top:40px!important\" v-show=\"toggleIniciarDetener\"> \n        <b-button  v-b-modal.modal-iniciar slot=\"footer\" type=\"primary\" fill>Iniciar</b-button>\n        <b-modal id=\"modal-iniciar\"\n            @ok=\"iniciarSimulacion\">\n            ¿Deseas iniciar la simulación?\n        </b-modal>\n      </div>\n      <div class=\"col-md-3\" style=\"margin-top:40px!important\" v-show=\"!toggleIniciarDetener\"> \n        <b-button  v-b-modal.modal-cancelar slot=\"footer\" type=\"primary\" fill>Cancelar</b-button>\n        <b-modal id=\"modal-cancelar\"\n            @ok=\"cancelarSimulacion\">\n            ¿Deseas cancelar la simulación?\n        </b-modal>\n      </div>\n      <div class=\"col-md-3\" style=\"margin-top:40px!important\" v-show=\"!toggleIniciarDetener && !toggleReanudar\"> \n        <b-button  v-b-modal.modal-detener slot=\"footer\" type=\"primary\" fill>Detener</b-button>\n        <b-modal id=\"modal-detener\"\n            @ok=\"detenerSimulacion\">\n            ¿Deseas detener la simulacion?\n        </b-modal>\n      </div>\n      <div class=\"col-md-3\" style=\"margin-top:40px!important\" v-show=\"!toggleIniciarDetener && toggleReanudar\"> \n        <b-button  v-b-modal.modal-reanudar slot=\"footer\" type=\"primary\" fill>Reanudar</b-button>\n        <b-modal id=\"modal-reanudar\"\n            @ok=\"reanudarSimulacion\">\n            ¿Deseas reanudar la simulación?\n        </b-modal>\n      </div>\n    </div>\n    \n  </div>\n</template>\n\n<script>\nimport Mapbox from \"mapbox-gl\";\nimport {MglMap, MglNavigationControl, MglGeojsonLayer} from \"vue-mapbox\";\nimport Mapa from '@/store/map.json';\nimport Mapa2 from '@/store/map2.json';\nimport axios from 'axios';\nimport Authentication from '@/store/authentication.js';\nimport Simulation from '@/store/simulation.js';\n\nexport default {\n  components: {\n    MglMap,\n    MglNavigationControl,\n    MglGeojsonLayer\n  },\n  data() {\n    return {\n      isLegendOpen: false,\n      currentDateTime: new Date().toLocaleString('es-ES', { \n        timeZone: 'America/Lima', \n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit', \n        minute: '2-digit', \n        timeZoneName: 'short' \n      }),\n      toggleIniciarDetener: true,\n      toggleReanudar: false,\n      accessToken: this.$store.state.map.token, // your access token. Needed if you using Mapbox maps\n      mapStyle: 'mapbox://styles/mapbox/dark-v10',\n      center: [5,15],\n      zoom: 2,\n      sedes:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"sedes\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      sedesCount:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"sedesCount\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa.features\n        },\n        \n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      rutas:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"rutas\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa2.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      rutasCount:{\n        type:'geojson',\n        //data: 'https://docs.mapbox.com/mapbox-gl-js/assets/earthquakes.geojson',\n        data: {\n          \"id\" : \"rutasCount\",\n          \"type\": \"FeatureCollection\",\n          \"crs\": { \"type\": \"name\", \"properties\": { \"name\": \"urn:ogc:def:crs:OGC:1.3:CRS84\" } },\n          \"features\": Mapa2.features\n        },\n        cluster:false,\n        clusterMaxZoom: 14,\n        clusterRadius: 50\n      },\n      sedesLayer:{\n        id: 'sedesLayer',\n        type: 'circle',\n        source: 'sedes',\n        filter: ['has', 'capacidad'],\n        paint: {\n            'circle-color':'#3b9e6e',\n            'circle-radius':26\n\n        }\n      },\n      sedesLayerCount:{\n        id:'sedesLayerCount',\n        type: 'symbol',\n        source: 'sedesCount',\n        filter: ['has', 'capacidad'],\n        layout: {\n            'text-field': '{capacidad}',\n            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n            'text-size': 12\n        }\n      },\n      rutasLayer:{\n        id: 'rutasLayer',\n        type: 'circle',\n        source: 'rutas',\n        filter: ['has', 'capacidad'],\n        paint: {\n            'circle-color':'#8965e0',\n            'circle-radius':15\n\n        }\n      },\n      rutasLayerCount:{\n        id:'rutasLayerCount',\n        type: 'symbol',\n        source: 'rutasCount',\n        filter: ['has', 'capacidad'],\n        layout: {\n            'text-field': '{capacidad}',\n            'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],\n            'text-size': 12\n        }\n      },\n\n      myInterval: null,\n      myIntervalReplan:null,\n\n      fecha_inicio_simulacion: null,\n      fecha_fin_simulacion: null,\n\n      type: [\"\", \"info\", \"success\", \"warning\", \"danger\"],\n      notifications: {\n        topCenter: false\n      }\n      \n    }\n  },\n  mounted(){\n    \n    let vue = this;\n    this.updateTime();\n  },\n  destroyed:{\n  },\n  methods: {\n\n\n    toggleLegend() {\n      this.isLegendOpen = !this.isLegendOpen;\n    },\n\n    updateTime() {\n\n      setInterval(() => {\n        this.currentDateTime = new Date().toLocaleString('es-ES', { \n          timeZone: 'America/Lima', \n          year: 'numeric',\n          month: '2-digit',\n          day: '2-digit',\n          hour: '2-digit', \n          minute: '2-digit', \n          timeZoneName: 'short'\n        });\n      }, 1000); },\n    onMapLoaded(event) {\n      // in component\n      this.map = event.map;\n      // or just to store if you want have access from other components\n      this.$store.map = event.map;\n    },\n    iniciarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = false;\n\n/*\n      vue.myInterval = setInterval(()  =>{\n        axios.get(vue.$store.state.appUri + '/sedes/listarSedes')\n        .then(function(response){\n          console.log(response.data)\n          response.data.forEach(element => {  \n            Mapa.features.push(\n              { \"type\": \"Feature\",\n                \"properties\": { \"id\": element.codigoOaci,  \"capacidad\": element.codigoOaci + \":  \" + element.numero_paquetes.toString() },\n                \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.coordenadas[1],element.coordenadas[0],0.0]}\n              }\n            );       \n          });\n        })\n        .catch(function(error){\n          console.log(error);\n        });\n      }, 10000);\n*/\n\n      /*MOSTRAR RUTAS*/\n      \n      axios.post(vue.$store.state.appUri + '/simulacion/simular/'+ vue.fecha_inicio_simulacion.substring(8,10)+\n                                                              '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                              '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                              '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                              '/'+Authentication.getProfile().id)\n      .then(function(response){\n        Simulation.runSimulation(response.data.simulacion.id);\n        console.log(Simulation.getIdSimulation());\n\n        /*\n        axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion2/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                                          '/'+Simulation.getIdSimulation());  \n        */\n\n        var date = new Date();\n        var day = date.getDate();\n        var month = date.getMonth() + 1;\n        var year = date.getFullYear();\n        var hour = date.getUTCHours();\n        var min = date.getUTCMinutes();\n\n        if(hour + 4 >= 24){\n          hour= hour + 4 - 24;\n        }\n\n        axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                          '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                          '/'+hour.toString()+'/'+min.toString()+'/'+Simulation.getIdSimulation());\n\n\n\n        /*TIMER REPLANIFICACION*/\n        vue.myIntervalReplan = setInterval(()  =>{\n\n          var date = new Date();\n          var day = date.getDate();\n          var month = date.getMonth() + 1;\n          var year = date.getFullYear();\n          var hour = date.getUTCHours();\n          var min = date.getUTCMinutes();\n          var diaSim;\n\n          if(hour + 4 >= 24){\n            hour= hour + 4 - 24;\n            diaSim = Number(vuefecha_inicio_simulacion) + 1;\n          }else{\n            hour= hour + 4;\n          }\n\n          axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion/'  +diaSim.toString()+//  vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                            '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                            '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                            '/'+hour.toString()+'/'+min.toString()+'/'+Simulation.getIdSimulation())\n          .then(function(response){\n            axios.post(vue.$store.state.appUri + '/paquetes/actualizarEstadoPaquetes/' +day.toString()+\n                                                                                    '/'+month.toString()+\n                                                                                    '/'+year.toString()+\n                                                                                    '/'+hour.toString()+\n                                                                                    '/'+min.toString())\n          });\n        }, 600000);\n\n\n        /*TIMER MAPA*/\n        vue.myInterval = setInterval(()  =>{          \n\n\n          axios.get(vue.$store.state.appUri + '/simulacion/mapa/'+Simulation.getIdSimulation())\n          .then(function(response2){\n\n            if(response2.data.c != null){              \n              console.log(\"SE DETIENE LA SIMULACION\");\n              console.log(response2.data);\n              Simulation.stopSimulation();\n              clearInterval(vue.myInterval);\n              this.notifyVue('top', 'center',4,NotificationTemplatePaqueteError);\n            }else{\n              console.log(response2.data);\n              //Mapa.features = [];\n              //Mapa2.features = [];\n              \n              response2.data.sedes.forEach(element => {               \n                \n              Mapa.features.push(\n                  { \"type\": \"Feature\",\n                    \"properties\": { \"id\": element.codigoOaci,  \"capacidad\": element.codigoOaci + \":  \" + Math.abs(element.numero_paquetes).toString() },\n                    \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.latitud,element.longitud,0.0]}\n                  }\n                );       \n              });\n\n\n              response2.data.rutasDto.forEach(element => {  \n              Mapa2.features.push(\n                  { \"type\": \"Feature\",\n                    \"properties\": { \"id\": element.id,  \"capacidad\": element.numero_paquetes_ruta.toString() },\n                    \"geometry\": { \"type\": \"Point\", \"coordinates\": [element.coordenadas[1],element.coordenadas[0],0.0]}\n                  }\n                );       \n              });\n            }\n\n\n          });\n        }, 300000);\n\n      });\n\n\n    },\n    detenerSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = true;\n      \n    },\n    reanudarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = false;\n      vue.toggleReanudar = false;\n    },\n    cancelarSimulacion(){\n      let vue = this;\n      vue.toggleIniciarDetener = true;\n      console.log(\"SE DETIENE LA SIMULACION\");\n      clearInterval(vue.myInterval);\n      Simulation.stopSimulation();\n      console.log(vue.fecha_fin_simulacion);\n    },\n    async simu(){\n      let vue = this;\n      let response = axios.post(vue.$store.state.appUri + '/algoritmos/replanificacion2/'  +vue.fecha_inicio_simulacion.substring(8,10)+\n                                                                                        '/'+vue.fecha_inicio_simulacion.substring(5,7)+\n                                                                                        '/'+vue.fecha_inicio_simulacion.substring(0,4)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(8,10)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(5,7)+\n                                                                                        '/'+vue.fecha_fin_simulacion.substring(0,4)+\n                                                                                        '/'+Simulation.getIdSimulation());\n        console.log(response.data);  \n    },\n    notifyVue(verticalAlign, horizontalAlign,color,componente) {\n      //const color = 4;\n      //console.log(color);\n      this.$notify({\n        component: componente,\n        icon: \"tim-icons icon-bell-55\",\n        horizontalAlign: horizontalAlign,\n        verticalAlign: verticalAlign,\n        type: this.type[color],\n        timeout: 0\n      });\n    }\n\n\n    /*\n    calcularTriangulacion(x1,x2,y1,y2,porcentaje){\n\n      var distanciaX = Math.abs(x1-x2)*porcentaje;\n      var distanciaY = Math.abs(y1-y2)*porcentaje;\n\n      var nuevaCoordenada = [];\n\n      if(x1>x2){\n        nuevaCoordenada.push(x1-distanciaX);\n      }else{\n        nuevaCoordenada.push(x1+distanciaX);\n      }\n\n      if(y1>y2){\n        nuevaCoordenada.push(y1-distanciaY);\n      }else{\n        nuevaCoordenada.push(y1+distanciaY);\n      }\n\n      return nuevaCoordenada.push(0.00);\n    } background-color: #1e1e24;\n    */\n  }\n}\n</script>\n<style scoped>\n.datetime-display {\n  position: absolute;\n  top: 10px;\n  right: 10px;\n  color: white;\n  background-color: rgba(0, 0, 0, 0.7);\n  padding: 5px 10px;\n  border-radius: 5px;\n  z-index: 1001; /* Asegúrate de que esté visible sobre el mapa */\n}\n\n.map-container {\n  position: relative;\n  height: 100vh;\n  width: 100%;\n  \n}\n\n.map-header {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 1000;\n  width: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  padding: 10px;\n  color: #fff;\n  text-align: center;\n}\n\n.map-title {\n  font-size: 1.5em;\n}\n\n.map-tagline {\n  font-size: 1em;\n}\n\n.map-search-container {\n  .map-search-container {\n  position: absolute;\n  top: 60px;\n  left: 10px; /* Ajusta según necesidad */\n  z-index: 1000;\n  width: 200px; /* Ancho fijo para todos los inputs */\n  padding: 10px;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  flex-direction: column; /* Cambio aquí */\n  align-items: flex-start; /* Alinear al inicio (izquierda) */\n}\n}\n\n.search-input {\n  flex: 1;\n  margin: 0 5px;\n  padding: 10px;\n  border: none;\n  border-radius: 5px;\n}\n\n.main-map {\n  height: 100%;\n  width: 100%;\n}\n\n.map-sidebar {\n  position: absolute;\n  top: 0;\n  right: 0;\n  z-index: 1000;\n  height: 100%;\n  width: 300px;\n  background-color: rgba(0, 0, 0, 0.5);\n  color: #fff;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n}\n\n\n.brand-title {\n  font-size: 1em; /* Ajusta el tamaño como desees */\n  color: #fff; /* Color para 'Redex' */\n  font-weight: bold;\n}\n\n.brand-title-point {\n  font-size: 1em; /* Asegúrate de que sea del mismo tamaño que .brand-title para alineación adecuada */\n  color: #00B074; /* Color para el punto */\n  font-weight: bold;\n}\n\n.brand-tagline {\n  font-size: 1em; /* Ajusta el tamaño del tagline */\n  color: #B9BBBD; /* Color para 'Always on Time' */\n  font-weight: bold;\n  margin-bottom: 199px;\n  display: flex;\n  align-items: baseline; /* Alinea correctamente el texto y el punto */\n  gap: 0.2em; /* Ajusta el espacio entre 'Redex' y el punto */\n}\n\n/* Si deseas que 'Redex.' esté en una sola línea, puedes usar display: flex en el contenedor */\n.brand {\n  display: flex;\n  align-items: baseline; /* Alinea correctamente el texto y el punto */\n  gap: 0.2em; /* Ajusta el espacio entre 'Redex' y el punto */\n  \n  margin-bottom: -5px; /* Ajusta esto para aumentar el espacio entre el título y el subtítulo */\n\n}\n\n\n\n\n\n.map-legend {\n  color: black; /* Cambia el color de texto a negro */\n  position: absolute;\n  bottom: 120px;\n  right: 20px;\n  z-index: 1000;\n  background: #fff;\n  padding: 10px;\n  border-radius: 5px;\n  box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n  cursor: pointer;\n}\n\n.legend-toggle {\n  background: #333;\n  color: #fff;\n  padding: 5px 10px;\n  border: none;\n  border-radius: 3px;\n  cursor: pointer;\n  display: block;\n  width: 100%;\n  text-align: center;\n}\n\n.legend-content {\n  color: black;\n  list-style: none;\n  padding: 0;\n  margin: 0; /* Remove margin-top when visible */\n  display: none; /* Hidden by default */\n}\n\n.legend-content li {\n  color: black; \n  margin-bottom: 5px;\n  display: flex;\n  align-items: center;\n}\n\n.dot {\n\n  height: 10px;\n  width: 10px;\n  border-radius: 50%;\n  display: inline-block;\n  margin-right: 10px;\n}\n\n.less-50 { background: red; }\n.between-50-80 { background: orange; }\n.greater-80 { background: green; }\n\n.icon {\n  width: 16px;\n  height: 16px;\n  display: inline-block;\n  background-size: contain;\n  background-repeat: no-repeat;\n  margin-right: 10px;\n}\n\n.airplane-icon { background-image: url('/img/avion.png'); }\n.airport-icon { background-image: url('/img/ubi.png'); }\n\n\n</style>\n"]}]}